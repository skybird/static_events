<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=320,maximum-scale=1.3,user-scalable=no">
    <link href="css/build.css" rel="stylesheet" type="text/css">
    <link href="css/jquery.fullPage.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/judgeScreenSize.js"></script>
    <script type="text/javascript" src="js/fastclick.js"></script>
    <title>一颗神秘的选股产品，1818个预约名额快来抢！</title>
    <meta name="description" content="最强选股势力对你说：别懵在“股”里">
</head>
<script>
    var ua = navigator.userAgent.toLowerCase();
    if (ua.indexOf('android') != -1 || ua.indexOf("micromessenger") != -1 || ua.indexOf('iphone') != -1) {
    }
    else {
        window.location.href = 'pick_pc.html'
    }
</script>
<body>
    <img id="share-icon" src="img/share-icon.jpg" alt="" />
    <div id="fullpage">
        <div class="section " id="section0">
            <div class="slide " id="slide0">
                <div class="slide0-title bounceInDown"></div>
                <div class="egg slideInDown">
                    <div class="egg-head swing"></div>
                    <div class="egg-body"></div>
                </div>
                <img class="slide0-title2 slideInUp" id='slide0-title2' src="img/slide0-title2.png">
                <!-- <div class="slide0-title2 slideInUp"></div> -->
            </div>
            <div class="slide" id="slide1">
                <div class="slide1-img fly4r"></div>
                <div class="minutes5 fly4r"></div>
                <div class="their fly4l"></div>
            </div>
            <div class="slide" id="slide2">
                <div class="slide2-img fly4r"></div>
                <div class="b100 fly4r"></div>
                <div class="their2 fly4l"></div>
            </div>
            <div class="slide" id="slide3">
                <div class="slide3-img fly4r"></div>
                <div class="jihe fly4r"></div>
                <div class="slideImg1 slideImg"></div>
                <div class="slideImg2 slideImg"></div>
                <div class="slideImg3 slideImg"></div>
                <div class="their3 slideImg"></div>
            </div>
            <div class="slide" id="slide4">
                <div class="slide4-img"></div>
                <div class="m1818"></div>
                <div class="residue-num">剩余名额：<span id='num'>99</span></div>
                <form role="form" action="../../app/form.php" method="get" id='new_entry'>
                    <input type="hidden" name="form_id" value="NEXYZU">
                    <input type="phone" name="field_1" id="entry_field_1" placeholder="填写手机号" class="phoneNum">
                    <div class="common-bottom2">
                        <button class='commit-btn'></button>
                        <div class="appointment"></div>
                    </div>
                </form>
                <div class="shareGuide swing"></div>
            </div>
            <ul class="nav">
                <li class='nav-item active'></li>
                <li class='nav-item'></li>
                <li class='nav-item'></li>
                <li class='nav-item'></li>
                <li class='nav-item'></li>
            </ul>
            <div class="common-bottom">
                <div class="try-btn"></div>
                <div class="appointment"></div>
            </div>
            <div class="detail">
                <div class="closeBtn"></div>
            </div>
            <div class="success-container">
                <div class="closeBtn2"></div>
                <div class="success-btn">
                    <div class="back-btn"></div>
                    <a class='weixinA join-btn' href='http://mp.weixin.qq.com/s?__biz=MzAwMjU1NDUwNw==&mid=205350004&idx=1&sn=2046cf76c55512375237669d80187575#rd'>
                        <div class="smallEgg"></div>
                    </a>
                </div>
            </div>
            <div class="tooLate">
                <a class='weixinA join-btn' href='http://mp.weixin.qq.com/s?__biz=MzAwMjU1NDUwNw==&mid=205350004&idx=1&sn=2046cf76c55512375237669d80187575#rd'>
                    <div class="smallEgg"></div>
                </a>
            </div>
            <div class="hasPlayed">
                <div class="closeBtn3"></div>
                <div class="success-btn2">
                    <div class="back-btn"></div>
                    <a class='weixinA join-btn' href='http://mp.weixin.qq.com/s?__biz=MzAwMjU1NDUwNw==&mid=205350004&idx=1&sn=2046cf76c55512375237669d80187575#rd'>
                        <div class="smallEgg"></div>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <audio id="egg" src="bgm.mp3" preload="auto"></audio>
</body>
<script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="js/jquery.fullPage.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script>
$(function() {

    $(function() {
        FastClick.attach(document.body);
    });

    var egg = document.getElementById("egg");
    var imgSrc = $('#slide0-title2').attr('src');
    var tamp = Date.parse(new Date());

    $('#slide0-title2').attr('src', imgSrc + '?' + tamp)
    $('#slide0-title2').load(function() {
        setTimeout(function() {
            egg.play();
        }, 2000)

    });

     var ua = navigator.userAgent.toLowerCase();
     if(ua.indexOf("micromessenger") != -1 ){
        $('.weixinA').attr('href', 'http://mp.weixin.qq.com/s?__biz=MzAwMjU1NDUwNw==&mid=205402366&idx=1&sn=fa8476d6cb806c90bb6556932a1832d1#rd');
     }
    else{
        $('.weixinA').attr('href', 'http://mp.weixin.qq.com/s?__biz=MzAwMjU1NDUwNw==&mid=205350004&idx=1&sn=2046cf76c55512375237669d80187575#rd');
    }

    $('#fullpage').fullpage({
        controlArrows: false,
        verticalCentered: false,
        loopHorizontal: false,
        scrollingSpeed: 500,
        afterSlideLoad: function(anchorLink, index, slideAnchor, slideIndex) {
            var loadedSlide = $(this);

            if (slideIndex == '1') {
                egg.pause();
            }

            loadedSlide.find('.fly4r').addClass('zoomInRight');
            setTimeout(function() {
                loadedSlide.find('.fly4l').addClass('zoomInLeft');
            }, 600)

            $('.nav-item').eq(slideIndex).addClass('active').siblings().removeClass('active');
            if (slideIndex == '3') {
                $('.slideImg').addClass('fadeIn')
            }
        },
        onSlideLeave: function(anchorLink, index, slideIndex, direction) {
            if ((slideIndex == '3') && (direction == 'right')) {
                $('.common-bottom').addClass('last');
            }
            if (slideIndex == '4') {
                $('.common-bottom').removeClass('last');
            }
        }
    });



    var hasChanceUrl = 'http://wallstreetcn.com/operation/counter/get/1818?callback=_counter'

    function hasChance() {
        // get data
        $.ajax({
            url: hasChanceUrl,
            type: 'get',
            dataType: 'jsonp',
            success: function(data) {
                $('#num').text(data);
            },
            error: function(xhr, textStatus) {
                // 
            }
        })
    }

    ;
    (function judgeChance() {
        hasChance()
    })();


    $('.appointment').on("click", function(event) {
        $('.detail').addClass('zoomInDown').removeClass('zoomOut');
    });

    $('.closeBtn').on("click", function(event) {
        $('.detail').addClass('zoomOut').removeClass('zoomInDown');
    });

    $('.closeBtn2').on("click", function(event) {
        $('.success-container').addClass('bounceOutLeft').removeClass('rubberBand');
    });

    $('.closeBtn3').on("click", function(event) {
        $('.hasPlayed').addClass('bounceOutLeft');
    });

    $("#fullpage").on("click", '.try-btn', function(event) {
        $('#fullpage').fullpage.silentMoveTo(0, 4);
        $('.common-bottom').addClass('last');
        $('.nav-item').eq(4).addClass('active').siblings().removeClass('active');
    });

    $('.back-btn').on("click", function(event) {
        $('#fullpage').fullpage.silentMoveTo(0, 0);
        $('.success-container').hide();
        $('.hasPlayed').hide();
    });

    $("form").on("submit", function(event) {
        event.preventDefault();
        var n = /^1[34578][0-9]{9}$/;
        var phoneNum = $('#entry_field_1').val();
        if (!n.test(phoneNum)) {
            $('#entry_field_1').val('');
            $('#entry_field_1').attr('placeholder', '手机号错误');
            event.preventDefault();
            return false;
        }

        if ($('#num').text() == 0) {
            $('.tooLate').show();
            return false;
        }
        if ($.cookie(phoneNum)) {
            $('.hasPlayed').show().removeClass('bounceOutLeft');
            return false;
        }
        postForm();
    });


    function postForm() {
        // e.preventDefault();

        var data = {};
        var url = $('#new_entry').attr('action');

        //提交具有name属性的元素内容
        $('form').find('[name]').each(function() {
            data[$(this).attr('name')] = $(this).val();
        });

        $.ajax({
            type: 'get',
            url: url,
            data: data,
            success: function(data) {
                var pNum = $('.phoneNum').val();
                $('.success-container').removeClass('bounceOutLeft').addClass("rubberBand");
                $('.smallEgg').addClass("swing");
                $.getScript("http://wallstreetcn.com/operation/counter/decrease/1818");
                $.cookie(pNum, 'true', {
                    expires: 8
                });
            },
            error: function(data) {
                var pNum = $('.phoneNum').val();
                $('.success-container').removeClass('bounceOutLeft').addClass("rubberBand");
                $('.smallEgg').addClass("swing");
                $.getScript("http://wallstreetcn.com/operation/counter/decrease/1818");
                $.cookie(pNum, 'true', {
                    expires: 8
                });
            }
        })
    }
});
</script>
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?c9477ef9d8ebaa27c94f86cc3f505fa5";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

</html>
